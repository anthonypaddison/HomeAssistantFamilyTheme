type: vertical-stack
cards:
  # DAY
  - type: conditional
    conditions:
      - entity: input_select.calendar_view
        state: Day
    card:
      type: custom:week-planner-card
      title: ''
      days: 1
      startingDay: today
      noCardBackground: true
      eventBackground: var(--family-cal-event-bg)
      compact: true
      showLegend: true
      legendToggle: true
      showNavigation: true
      hideDaysWithoutEvents: false
      columns:
        extraLarge: 5
        large: 5
        medium: 3
        small: 2
        extraSmall: 1
      calendars:
        - entity: calendar.family
          name: Family
          color: var(--family-color-family)
          hideInLegend: true
        - entity: calendar.family
          name: A
          color: var(--family-color-anthony)
          filter: "(?i)(^Anthony:|\\[A\\])"

        - entity: calendar.family
          name: J
          color: var(--family-color-joy)
          filter: "(?i)(^Joy:|\\[J\\])"

        - entity: calendar.family
          name: L
          color: var(--family-color-lizzie)
          filter: "(?i)(^Lizzie:|\\[L\\])"

        - entity: calendar.family
          name: T
          color: var(--family-color-toby)
          filter: "(?i)(^Toby:|\\[T\\])"
      card_mod:
        style: |
          /* Right-align the legend row and make color dots circular */
          ha-card .legend {
            display: flex !important;
            justify-content: flex-end !important;
            gap: 8px !important;
            flex-wrap: wrap !important;
            margin-right: 6px !important;
          }
          ha-card .legend .calendar .color {
            width: 35px !important;
            height: 35px !important;
            border-radius: 50% !important;
          }
          .container .legend ul li.hasToggle {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            width: 28px !important;
            height: 28px !important;
            border-radius: 50% !important;
            background-color: var(--legend-calendar-color) !important;
            color: white !important;
            font-weight: bold !important;
            font-size: 14px !important;
            list-style: none !important;
          }


  # WEEK
  - type: conditional
    conditions:
      - entity: input_select.calendar_view
        state: Week
    card:
      type: custom:week-planner-card
      title: ''
      days: 5
      startingDay: today
      noCardBackground: true
      eventBackground: var(--family-cal-event-bg)
      compact: true
      showLegend: true
      legendToggle: true
      showNavigation: true
      hideDaysWithoutEvents: false
      columns:
        extraLarge: 5
        large: 5
        medium: 3
        small: 2
        extraSmall: 1
      calendars:
        - entity: calendar.family
          name: Family
          color: var(--family-color-family)
          hideInLegend: true
        - entity: calendar.family
          name: A
          color: var(--family-color-anthony)
          filter: "(?i)(^Anthony:|\\[A\\])"

        - entity: calendar.family
          name: J
          color: var(--family-color-joy)
          filter: "(?i)(^Joy:|\\[J\\])"

        - entity: calendar.family
          name: L
          color: var(--family-color-lizzie)
          filter: "(?i)(^Lizzie:|\\[L\\])"

        - entity: calendar.family
          name: T
          color: var(--family-color-toby)
          filter: "(?i)(^Toby:|\\[T\\])"
      card_mod:
        style: |
          ha-card .legend {
            display: flex; justify-content: flex-end; gap: 8px; flex-wrap: wrap;
            margin-right: 6px;
          }
          ha-card .legend .calendar .color {
            width: 14px; height: 14px; border-radius: 50%;
          }

  # MONTH
  - type: conditional
    conditions:
      - entity: input_select.calendar_view
        state: Month
    card:
      type: custom:week-planner-card
      title: ''
      days: 30
      startingDay: today
      noCardBackground: true
      eventBackground: var(--family-cal-event-bg)
      compact: true
      showLegend: true
      legendToggle: true
      showNavigation: true
      hideDaysWithoutEvents: false
      columns:
        extraLarge: 5
        large: 5
        medium: 3
        small: 2
        extraSmall: 1
      calendars:
        - entity: calendar.family
          name: Family
          color: var(--family-color-family)
          hideInLegend: true
        - entity: calendar.family
          name: A
          color: var(--family-color-anthony)
          filter: "(?i)(^Anthony:|\\[A\\])"

        - entity: calendar.family
          name: J
          color: var(--family-color-joy)
          filter: "(?i)(^Joy:|\\[J\\])"

        - entity: calendar.family
          name: L
          color: var(--family-color-lizzie)
          filter: "(?i)(^Lizzie:|\\[L\\])"

        - entity: calendar.family
          name: T
          color: var(--family-color-toby)
          filter: "(?i)(^Toby:|\\[T\\])"
      card_mod:
        style: |
          ha-card .legend {
            display: flex; justify-content: flex-end; gap: 8px; flex-wrap: wrap;
            margin-right: 6px;
          }
          ha-card .legend .calendar .color {
            width: 14px; height: 14px; border-radius: 50%;
          }

  # Add Calendar Event (popup) - visible on Calendar section
  - type: button
    icon: mdi:plus
    name: ''
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
      data:
        title: Add Calendar Event
        size: wide
        content:
          type: vertical-stack
          card_mod:
            style: |
              :host ha-dialog {
                --mdc-dialog-min-width: 50px;
                --mdc-dialog-max-width: 50px;
              }
              hui-button-card {
                position: fixed !important;
                bottom: 20px !important;
                right: 20px !important;
                background: #0078d7 !important;
                color: white !important;
                padding: 10px 15px !important;
                border-radius: 8px !important;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
              }
              div.mdc-dialog div.mdc-dialog__scrim {
                backdrop-filter: blur(6px);
                background: green;
                color: white;
              }
              div.mdc-dialog .mdc-dialog__surface {
                background: green;
                color: white;
                border-radius: 50%;
                border: 1px solid var(--family-cal-grid-line);
              }
          cards:
            - type: input-text
              entity: input_text.calendar_event_title
              name: Title
            - type: input-text
              entity: input_text.calendar_event_description
              name: Description
            - type: input-datetime
              entity: input_datetime.calendar_event_start
              name: Start
              with_time: true
            - type: input-datetime
              entity: input_datetime.calendar_event_end
              name: End
              with_time: true
            - type: input-boolean
              entity: input_boolean.calendar_all_day
              name: All Day
            - type: button
              name: Save Event
              icon: mdi:check
              tap_action:
                action: call-service
                service: script.add_calendar_event
              card_mod:
                style: |
                  :host { position: fixed; right: 24px; bottom: 24px; z-index: 1000; }
                  ha-card {
                    width: 64px; height: 64px;
                    border-radius: 50%;
                    background: var(--primary-color);
                    color: var(--primary-background-color);
                    box-shadow: 0 8px 18px rgba(0,0,0,.18);
                  }
                  ha-card .icon { --mdc-icon-size: 28px; }