type: vertical-stack
cards:

  # DAY (hourly time‑grid via FullCalendar)
  - type: conditional
    conditions:
      - entity: input_select.calendar_view
        state: Day
    card:
      type: custom:fullcalendar-card
      entities:
        - entity: calendar.family
          eventColor: var(--family-color-family)

      # Some builds expect "options:", others "fullcalendar:". Keep both.
      options:
        initialView: timeGridDay             # Single day with hour column
        nowIndicator: true                   # Moving "you-are-here" line
        slotDuration: "00:30:00"             # 30-min rows (use "01:00:00" for hourly)
        slotMinTime: "06:00:00"              # Earliest hour shown
        slotMaxTime: "22:00:00"              # Latest hour shown
        scrollTime: "08:00:00"               # Where to scroll to on load
        allDaySlot: true
        headerToolbar:
          left: 'prev,next today'
          center: 'title'
          right: ''
        locale: "en-gb"

      fullcalendar:
        initialView: timeGridDay
        nowIndicator: true
        slotDuration: "00:30:00"
        slotMinTime: "06:00:00"
        slotMaxTime: "22:00:00"
        scrollTime: "08:00:00"
        allDaySlot: true
        headerToolbar:
          left: 'prev,next today'
          center: 'title'
          right: ''
        locale: "en-gb"

      # Match your clean, backgroundless look
      card_mod:
        style: |
          ha-card {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
          }
          /* Keep a sensible min height for the grid */
          .fc { min-height: 560px; }

  # WEEK (5-day hourly time‑grid via FullCalendar)
  - type: conditional
    conditions:
      - entity: input_select.calendar_view
        state: Week
    card:
      type: custom:fullcalendar-card
      entities:
        - entity: calendar.family
          eventColor: var(--family-color-family)

      # Use a custom 5-day TimeGrid view starting from today
      options:
        initialView: timeGridFiveDay
        nowIndicator: true
        slotDuration: "00:30:00"
        slotMinTime: "06:00:00"
        slotMaxTime: "22:00:00"
        scrollTime: "08:00:00"
        allDaySlot: true
        headerToolbar:
          left: 'prev,next today'
          center: 'title'
          right: ''
        locale: "en-gb"
        views:
          timeGridFiveDay:
            type: timeGrid
            duration: { days: 5 }

      fullcalendar:
        initialView: timeGridFiveDay
        nowIndicator: true
        slotDuration: "00:30:00"
        slotMinTime: "06:00:00"
        slotMaxTime: "22:00:00"
        scrollTime: "08:00:00"
        allDaySlot: true
        headerToolbar:
          left: 'prev,next today'
          center: 'title'
          right: ''
        locale: "en-gb"
        views:
          timeGridFiveDay:
            type: timeGrid
            duration: { days: 5 }

      card_mod:
        style: |
          ha-card {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
          }
          .fc { min-height: 560px; }

  # MONTH (rolling 30 days, no times) — keep week-planner-card
  - type: conditional
    conditions:
      - entity: input_select.calendar_view
        state: Month
    card:
      type: custom:week-planner-card
      title: ''
      days: 30
      startingDay: today
      noCardBackground: true
      eventBackground: var(--family-cal-event-bg)
      compact: true
      showLegend: true
      legendToggle: true
      showNavigation: true
      hideDaysWithoutEvents: false
      columns:
        extraLarge: 5
        large: 5
        medium: 5
        small: 2
        extraSmall: 1
      calendars:
        - entity: calendar.family
          name: ''
          icon: 'mdi:home-heart'
          color: var(--family-color-family)
          hideInLegend: true
        - entity: calendar.family
          name: ''
          icon: 'mdi:alpha-a'
          color: var(--family-color-anthony)
          filter: "(?i)(^Anthony:\\[A\\])"
        - entity: calendar.family
          name: ''
          icon: 'mdi:alpha-j'
          color: var(--family-color-joy)
          filter: "(?i)(^Joy:\\[J\\])"
        - entity: calendar.family
          name: ''
          icon: 'mdi:alpha-l'
          color: var(--family-color-lizzie)
          filter: "(?i)(^Lizzie:\\[L\\])"
        - entity: calendar.family
          name: ''
          icon: 'mdi:alpha-t'
          color: var(--family-color-toby)
          filter: "(?i)(^Toby:\\[T\\])"
      card_mod:
        style: |
          ha-card .legend {
            display: flex !important;
            justify-content: flex-end !important;
            gap: 8px !important;
            flex-wrap: wrap !important;
            margin-right: 6px !important;
            float: right !important;
          }
          ha-card .legend .calendar .color {
            width: 14px !important;
            height: 14px !important;
            border-radius: 50% !important;
          }
          .container .legend ul li.hasToggle {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            width: 28px !important;
            height: 28px !important;
            border-radius: 50% !important;
            background-color: var(--legend-calendar-color) !important;
            color: white !important;
            font-weight: bold !important;
            font-size: 0px !important;
            list-style: none !important;
          }
          .container .legend ul li ha-icon {
            color: white !important;
            --mdc-icon-size: 50px !important;
          }

  # Add Calendar Event (popup) - visible on Calendar section
  - type: button
    icon: mdi:plus
    name: ''
    style: |
      :host {
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        background: #0078d7 !important;
        color: white !important;
        padding: 10px 15px !important;
        border-radius: 8px !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
      }
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: Add Calendar Event
          size: wide
          content:
            type: vertical-stack
            card_mod:
              style: |
                :host ha-dialog {
                  --mdc-dialog-min-width: 80%;
                  --mdc-dialog-max-width: 80%;
                }
                div.mdc-dialog div.mdc-dialog__scrim {
                  backdrop-filter: blur(6px);
                }
                div.mdc-dialog .mdc-dialog__surface {
                  border-radius: 50%;
                  border: 1px solid var(--family-cal-grid-line);
                }
            cards:
              - type: input-text
                entity: input_text.calendar_event_title
                name: Title
              - type: input-text
                entity: input_text.calendar_event_description
                name: Description
              - type: input-datetime
                entity: input_datetime.calendar_event_start
                name: Start
                with_time: true
              - type: input-datetime
                entity: input_datetime.calendar_event_end
                name: End
                with_time: true
              - type: input-boolean
                entity: input_boolean.calendar_all_day
                name: All Day
              - type: button
                name: Save Event
                icon: mdi:check
                tap_action:
                  action: call-service
                  service: script.add_calendar_event
                card_mod:
                  style: |
                    /* Float the FAB inside the dialog content area (bottom-right) */
                    :host {
                      position: absolute;
                      inset-inline-end: 24px; /* right in LTR, left in RTL */
                      inset-block-end: 24px;  /* bottom */
                      z-index: 10;
                    }
                    ha-card {
                      width: 64px; height: 64px;
                      border-radius: 50%;
                      display: grid; place-items: center;
                      background: var(--primary-color);
                      color: var(--primary-background-color);
                      box-shadow: 0 8px 18px rgba(0,0,0,.18);
                    }
                    ha-card .icon { --mdc-icon-size: 28px; }
