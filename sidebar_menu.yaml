button_card_templates:
family_icon:
  show_name: false
  show_icon: true
  styles:
    card:
      - width: 100% !important
      - height: 75px
      - border-radius: 0
      - box-shadow: none
      - background: var(--sb-inactive-bg)
      - color: var(--sb-inactive-icon)
      - place-items: center
      - position: relative
      - padding: 0
    icon:
      - width: 50px
      - height: 50px

sb_icon_only:
  variables:
    section: ""
    badge_entity: ""
  show_name: false
  show_icon: true
  custom_fields:
    badge: >
      [[[
        const e = variables.badge_entity ? states[variables.badge_entity] : null;
        const n = e ? Number(e.state ?? 0) : 0;
        return n > 0 ? `${n}` : '';
      ]]]
  styles:
    card:
      - width: 100% !important
      - height: 75px
      - border-radius: 0
      - box-shadow: none
      - background: var(--sb-inactive-bg) !important
      - color: var(--sb-inactive-icon) !important
      - place-items: center
      - padding: 0
      - transition: transform .05s ease
    icon:
      - width: 50px
      - height: 50px
    custom_fields:
      badge:
        - position: absolute
        - bottom: 6px
        - right: -6px
        - min-width: 20px
        - height: 20px
        - border-radius: 10px
        - background: white
        - color: "#0F172A"
        - font-weight: 800
        - font-size: 12px
        - display: flex
        - align-items: center
        - justify-content: center
        - border: 2px solid #0F172A
  state:
    - operator: template
      value: '[[[ return states["input_select.family_section"]?.state === variables.section; ]]]'
      styles:
        card:
          - background: var(--sb-active-bg)
          - color: var(--sb-active-icon)

type: vertical-stack
view_layout: { grid-area: sidebar }

cards:
  # Family Icon (top) - toggles HA main sidebar
  - type: custom:button-card
    template: family_icon
    icon: mdi:home-heart
    tap_action:
      action: call-service
      service: browser_mod.javascript
      data:
        code: |
          (function(){
            const root = document.querySelector('home-assistant');
            if (root) root.dispatchEvent(new CustomEvent('hass-toggle-menu', {bubbles:true, composed:true}));
          })();

  # Calendar (starts after heading + chips)
  - type: custom:button-card
    template: sb_icon_only
    icon: mdi:calendar
    styles:
      card:
        - margin-top: "calc(var(--family-heading-height,56px) + var(--family-chips-height,56px))"
    variables:
      section: Calendar
      badge_entity: input_number.events_today
    tap_action:
      action: call-service
      service: input_select.select_option
      target: { entity_id: input_select.family_section }
      data: { option: Calendar }

  # Chores (badge = total incomplete across lists)
  - type: custom:button-card
    template: sb_icon_only
    icon: mdi:broom
    variables:
      section: Chores
      badge_entity: sensor.chores_incomplete_total
    tap_action:
      action: call-service
      service: input_select.select_option
      target: { entity_id: input_select.family_section }
      data: { option: Chores }
