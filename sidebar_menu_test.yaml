# sidebar_menu_test.yaml
# Minimal, self-contained sidebar to validate: include path, custom resources, and CSS.
# Requires:
#   - custom:button-card  (/hacsfiles/button-card/button-card.js)
#   - custom:mod-card     (/hacsfiles/lovelace-card-mod/card-mod.js)

type: custom:mod-card
view_layout: { grid-area: sidebar }

card_mod:
  style: |
    :host {
      /* Local tokens (used by the buttons below) */
      --sb-inactive-bg:   var(--palette-lilac);
      --sb-inactive-icon: #0F172A;
      --sb-active-bg:     var(--family-background);
      --sb-active-icon:   #0F172A;

      /* Keep the sidebar pinned */
      position: sticky;
      top: 8px;
      z-index: 2;
    }

    /* Outer shell */
    ha-card {
      background: var(--card-background-color);
      border-radius: var(--ha-card-border-radius, 16px);
      box-shadow: var(--ha-card-box-shadow);
      padding: 0;
      overflow: visible;
    }

card:
  type: vertical-stack

  card_mod:
    style: |
      ha-card {
        background: transparent;
        box-shadow: none;
        border: 0;
        padding: 0;
      }
      /* Remove gaps between items */
      .card-content #root > * { margin: 0 !important; }

  cards:

    # --- Home (simple icon button) ---
    - type: custom:button-card
      show_name: false
      show_icon: true
      icon: mdi:home-heart
      styles:
        card:
          - width: 100% !important
          - height: 75px
          - border-radius: 0
          - box-shadow: none
          - background: var(--sb-inactive-bg)
          - color: var(--sb-inactive-icon)
          - place-items: center
          - padding: 0
        icon:
          - width: 50px
          - height: 50px
      tap_action:
        action: navigate
        navigation_path: /lovelace

    # --- Calendar (with badge and active styling) ---
    - type: custom:button-card
      show_name: false
      show_icon: true
      icon: mdi:calendar
      styles:
        card:
          - width: 100% !important
          - height: 75px
          - border-radius: 0
          - box-shadow: none
          - background: var(--sb-inactive-bg)
          - color: var(--sb-inactive-icon)
          - place-items: center
          - padding: 0
          - transition: transform .05s ease
          # Simulate space for heading/chips if you use them
          - margin-top: calc(48px + 56px)
        icon:
          - width: 50px
          - height: 50px
        custom_fields:
          badge:
            - position: absolute
            - bottom: 6px
            - right: -6px
            - min-width: 20px
            - height: 20px
            - border-radius: 10px
            - background: white
            - color: "#0F172A"
            - font-weight: 800
            - font-size: 12px
            - display: flex
            - align-items: center
            - justify-content: center
            - border: 2px solid #0F172A
      custom_fields:
        badge: >
          [[[
            // Safe if entity is missing
            const e = states['input_number.events_today'];
            const n = e ? Number(e.state ?? 0) : 0;
            return n > 0 ? `${n}` : '';
          ]]]
      tap_action:
        action: call-service
        service: input_select.select_option
        target: { entity_id: input_select.family_section }
        data: { option: Calendar }
      state:
        - operator: template
          value: '[[[ return states["input_select.family_section"]?.state === "Calendar"; ]]]'
          styles:
            card:
              - background: var(--sb-active-bg)
              - color: var(--sb-active-icon)

    # --- Chores (with badge and active styling) ---
    - type: custom:button-card
      show_name: false
      show_icon: true
      icon: mdi:broom
      styles:
        card:
          - width: 100% !important
          - height: 75px
          - border-radius: 0
          - box-shadow: none
          - background: var(--sb-inactive-bg)
          - color: var(--sb-inactive-icon)
          - place-items: center
          - padding: 0
          - transition: transform .05s ease
        icon:
          - width: 50px
          - height: 50px
        custom_fields:
          badge:
            - position: absolute
            - bottom: 6px
            - right: -6px
            - min-width: 20px
            - height: 20px
            - border-radius: 10px
            - background: white
            - color: "#0F172A"
            - font-weight: 800
            - font-size: 12px
            - display: flex
            - align-items: center
            - justify-content: center
            - border: 2px solid #0F172A
      custom_fields:
        badge: >
          [[[
            const e = states['sensor.chores_incomplete_total'];
            const n = e ? Number(e.state ?? 0) : 0;
            return n > 0 ? `${n}` : '';
          ]]]
      tap_action:
        action: call-service
        service: input_select.select_option
        target: { entity_id: input_select.family_section }
        data: { option: Chores }
      state:
        - operator: template
          value: '[[[ return states["input_select.family_section"]?.state === "Chores"; ]]]'
          styles:
            card:
              - background: var(--sb-active-bg)
              - color: var(--sb-active-icon)

    # --- Visible marker so you know the include loaded ---
    - type: markdown
      content: "_Sidebar loaded (test marker)._"

